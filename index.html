
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>王仙客的博客</title>
	<meta name="author" content="王仙客">

	
	<meta name="description" content="Feb 10th, 2015 fishhook和Aspects使用简单示例 fishhook: A library that enables dynamically rebinding symbols in Mach-O binaries running on iOS. #import &lt; &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="王仙客的博客" type="application/atom+xml">
	
	<link rel="canonical" href="http://Hydra2050.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("wh2050@sina.cn") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav"><ul class="main">
	<p style="color:white;font-size:24px">王仙客的博客</p>
	<br>
	<p style="color:white;font-size:18px">明白一些道理</p>
	<p style="color:white;font-size:18px">遇到一些有趣的事</p>
	<br>
	<li><a href="/">博客</a></li>
	<li><a href="/blog/archives">所有文章</a></li>
	<li><a href="/blog/2013/12/04/about/">关于我</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:wh2050@sina.cn" title="Email">Email</a>
		
		
		
		
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-10T10:27:11+08:00" data-updated="true" itemprop="datePublished">Feb 10<span>th</span>, 2015</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/02/10/fishhookhe-aspectsshi-yong-jian-dan-shi-li/" itemprop="url">fishhook和Aspects使用简单示例</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="https://github.com/facebook/fishhook">fishhook</a>: A library that enables dynamically rebinding symbols in Mach-O binaries running on iOS.</p>

<pre><code>#import &lt;dlfcn.h&gt;
#import "fishhook.h"

static OSStatus (*origin_AudioSessionSetProperty)(unsigned long, unsigned long, const void*);

void save_original_symbols() {
    origin_AudioSessionSetProperty = dlsym(RTLD_DEFAULT, "AudioSessionSetProperty");
}

OSStatus my_AudioSessionSetProperty(unsigned long inID, unsigned long inDataSize, const void *inData){
    printf("Calling real AudioSessionSetProperty: inID %ld  \n", inID);

    return origin_AudioSessionSetProperty(inID, inDataSize, inData);
}

int main(int argc, char * argv[]) {
 @autoreleasepool {
       save_original_symbols();
       rebind_symbols((struct rebinding[])AudioSessionSetProperty, 1);

       return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
     }
}
</code></pre>

<h1>Aspects</h1>

<p><a href="https://github.com/steipete/Aspects.git">Aspects</a>: Delightful, simple library for aspect oriented programming.</p>

<pre><code>[[AVAudioSession sharedInstance] aspect_hookSelector:@selector(setCategory:withOptions:error:) withOptions:0 usingBlock:^(id&lt;AspectInfo&gt; info,NSString *category, AVAudioSessionCategoryOptions option, NSError ** error){
    NSLog(@"AVAudioSession set category with category : %@", category);
}error:nil];
</code></pre>

<p>需要注意的一点，参数<code>block</code>需要与hook的函数相符，如果不匹配，会有如下提示：</p>

<pre><code>Aspects: Block signature &lt;NSMethodSignature: 0x7f93b8c35c80&gt; doesn't match &lt;NSMethodSignature: 0x7f93b8c33c30&gt;.
</code></pre>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-10T10:12:36+08:00" data-updated="true" itemprop="datePublished">Feb 10<span>th</span>, 2015</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/02/10/cong-dispatch-get-current-queue-shuo-qi/" itemprop="url">从dispatch_get_current_queue()说起</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><code>dispatch_get_current_queue</code>从iOS6.0开始被废弃掉，在《Effective Object-C 2.0》中，也单独有一个章节讲解。在队列同步操作的时候，有时需要检查当前的执行队列。在试图使用dispatch_get_current_queue判断当前队列的时候，仍然可能出错。</p>

<h2>使用dispatch_get_current_queue()存在的问题</h2>

<p>先看下面一段代码：</p>

<pre><code>    dispatch_queue_t queueA = dispatch_queue_create("c.b.a", NULL);
    dispatch_queue_t queueB = dispatch_queue_create("c.b.b", NULL);
    dispatch_sync(queueA, ^{
       dispatch_sync(queueB, ^{
           dispatch_block_t block = ^{
              // ...
           };
           dispatch_sync(queueA, ^{
               block();
           });
       });
    });
</code></pre>

<p>运行会发现死锁的情况，尝试使用dispatch_get_current_queue()来解决：</p>

<pre><code>dispatch_sync(queueA, ^{
           dispatch_sync(queueB, ^{
               dispatch_block_t block = ^{
                  // ...
               };
               if(dispatch_get_current_queue() == queueA){
                   block();
               }else{
                   dispatch_sync(queueA, ^{
                       block();
                   });
               }
           });
        });
</code></pre>

<p>运行后发现，同样会死锁。dispatch_get_current_queue判断，当前队列为queueB。</p>

<p>如果把每个队列看做一个管道，将管道B放在管道A中，dispatch_get_current_queue只能看到自己这一层，没法打破管道。</p>

<h2>dispatch_get_specific()试一试</h2>

<p>尝试使用dispatch_get_specific()关联键值对的方式判断当前队列：</p>

<pre><code>    dispatch_queue_t queueA = dispatch_queue_create("c.b.a", NULL);
    dispatch_queue_t queueB = dispatch_queue_create("c.b.b", NULL);
    static int kQueueSpecificA;
    static int kQueueSpecificB;
    dispatch_queue_set_specific(queueA, &amp;kQueueSpecificA, (void *)CFSTR("queueA"), (dispatch_function_t)CFRelease);
    dispatch_queue_set_specific(queueB, &amp;kQueueSpecificB, (void *)CFSTR("queueB"), (dispatch_function_t)CFRelease);
    dispatch_sync(queueA, ^{
       dispatch_sync(queueB, ^{
           dispatch_block_t block = ^{
              // ...
           };
           void *retrievedValueA = dispatch_get_specific(&amp;kQueueSpecificA);
           void *retrievedValueB = dispatch_get_specific(&amp;kQueueSpecificB);
           if(retrievedValueA){
                NSLog(@"queueA");
           }
           if(retrievedValueB){
                NSLog(@"queueB");
           }
           if(retrievedValueA){
               block();
           }else{
               dispatch_sync(queueA, ^{
                        block();
                    });
           }
       });
    });
</code></pre>

<p>运行之后，发现仍然有问题。dispatch_get_specific()仍然无法破壁，窥视外面的管道。</p>

<h2>破壁还需dispatch_set_target_queue()</h2>

<p>dispatch_set_target_queue()将第一个参数指定在第二个参数的队列内执行，同时也使参数A的队列优先级与参数B的队列相同。</p>

<pre><code>dispatch_queue_t queueA = dispatch_queue_create("c.b.a", NULL);
    dispatch_queue_t queueB = dispatch_queue_create("c.b.b", NULL);
    static int kQueueSpecificA;
    static int kQueueSpecificB;
    dispatch_queue_set_specific(queueA, &amp;kQueueSpecificA, (void *)CFSTR("queueA"), (dispatch_function_t)CFRelease);
    dispatch_queue_set_specific(queueB, &amp;kQueueSpecificB, (void *)CFSTR("queueB"), (dispatch_function_t)CFRelease);
    dispatch_set_target_queue(queueB, queueA);
        dispatch_sync(queueB, ^{
            dispatch_block_t block = ^{
                // ...
            };
            void *retrievedValueA = dispatch_get_specific(&amp;kQueueSpecificA);
            void *retrievedValueB = dispatch_get_specific(&amp;kQueueSpecificB);
            if(retrievedValueA){
                NSLog(@"queueA");
            }
            if(retrievedValueB){
                NSLog(@"queueB");
            }
            if(retrievedValueA){
                block();
            }else{
                dispatch_sync(queueA, ^{
                    block();
                });
            }
        });
</code></pre>

<p>  这样执行的结果就没有问题了~</p>

<h2>dispatch_set_target_queue()注意的问题</h2>

<p>执行上面的代码会发现，<code>retrievedValueA</code>和<code>retrievedValueB</code>都不为空。是的，这两个管道已经互通状态了！所以在使用的时候，判断的时候也需要注意。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-08T17:15:02+08:00" data-updated="true" itemprop="datePublished">Feb 8<span>th</span>, 2015</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/02/08/shi-yong-msweaktimerde-ci-crashwen-ti-jie-xi/" itemprop="url">使用MSWeakTimer的一次crash问题解析</a></h1>
	<div class="entry-content" itemprop="articleBody">
		

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-08T15:22:36+08:00" data-updated="true" itemprop="datePublished">Feb 8<span>th</span>, 2015</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/02/08/ru-he-chuang-jian-he-shi-yong-si-you-cocoapods-repo/" itemprop="url">如何创建和使用私有cocoapods Repo</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>安装cocoapods</h2>

<pre><code>gem update --system
gem sources -l
gem install cocoapods
pod setup
</code></pre>

<h2>创建私有cocoapods repo</h2>

<h3>第一步，创建私有Spec Repo</h3>

<p>在服务器创建repo裸仓库：</p>

<pre><code>mkdir REPO_NAME.git
cd REPO_NAME.git
git init --bare
</code></pre>

<h3>第二步，将私有pod repo添加到本地</h3>

<pre><code>pod repo list
pod repo add REPO_NAME SOURCE_URL
</code></pre>

<h3>第三步，检测pod repo是否正确</h3>

<pre><code>pod repo lint REPO_NAME
</code></pre>

<h2>为私有pod添加新的Spec</h2>

<h3>第一步，创建podspec文件</h3>

<pre><code>pod spec create SPEC_NAME
</code></pre>

<h3>第二步，修改Spec文件</h3>

<h3>第三步，检测Spec文件是否正确</h3>

<pre><code>pod spec lint SPEC_NAME
</code></pre>

<h3>第四步，上传Spec文件至私有pod repo</h3>

<pre><code>pod repo push REPO_NAME SPEC_NAME.podspec
</code></pre>

<p>因为我使用的时<code>ssh</code>URL获取，会产生<code>warning</code>：</p>

<pre><code>    - WARN  | [source] Git SSH URLs will NOT work for people behind firewalls configured to only allow HTTP, therefore HTTPS is preferred.
</code></pre>

<p>可以忽略这个警告：</p>

<pre><code>pod repo push --allow-warnings REPO_NAME SPEC_NAME.podspec
</code></pre>

<h2>spec lint 技巧</h2>

<p>在执行<code>pod spec line xxx</code>的时候出错，但提示往往比较简单，可以添加参数<code>--no-clean</code>：</p>

<pre><code>pod spec lint --no-clean xxx
</code></pre>

<p>执行完成后，根据提示的路径，打开lint生成的工程文件，编译查看出错的原因。</p>

<p>一般路径为：<code>/private/tmp/CocoaPods/Lint/Pods/Pods.xcodeproj</code>。</p>

<p>参考链接：<a href="http://guides.cocoapods.org/making/private-cocoapods.html">http://guides.cocoapods.org/making/private-cocoapods.html</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-08T14:05:04+08:00" data-updated="true" itemprop="datePublished">Feb 8<span>th</span>, 2015</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/02/08/ru-he-ti-gao-pod-installzhi-xing-su-du/" itemprop="url">如何提高pod Install执行速度</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>应用集成了cocoapods一段时间，发现每次执行<code>pod insgtall</code>命令都会比较慢，有时要等十多分钟甚至更久，严重影响工作效率和开发的心情。</p>

<h2><code>pod install</code>执行慢的原因</h2>

<p>Cocopods的<code>pod install</code>命令一般分两步：</p>

<ol>
<li>执行<code>pod repo update</code>，更新本地的repo Spec文件（<a href="https://github.com/CocoaPods/Specs.git">https://github.com/CocoaPods/Specs.git</a>）</li>
<li>根据spec的配置，获取源文件，一般是通过git clone的方式从github上下载第三方库</li>
</ol>


<p>由于<code>GWF</code>的存在，经常存在github无法访问的情况；有时可以访问，速度也比较慢。人生苦短！！</p>

<p>可以针对这两方面进行提高<code>pod install</code>执行速度。</p>

<h2>减少pod repo update的次数</h2>

<p>执行<code>pod repo update</code>是必要的，保证每次安装的时候，能够获取最新的Spec文件。但不必每次都执行，建议每天执行一次。在执行<code>pod install</code>的时候添加参数，不再执行<code>pod repo update</code>：</p>

<pre><code>pod install --no-repo-update
</code></pre>

<h2>使用本地的git mirror解决下载慢的问题</h2>

<p>解决了repo更新的问题，仍然存在一系列问题：</p>

<ul>
<li>将源文件克隆到本地速度缓慢</li>
<li>一旦被托管在github上的第三方库被删除掉，我们将再也无法获取到第三方库</li>
<li>如果访问外网的网络暂时性的中断，无法执行<code>pod install</code>，影响正常开发</li>
</ul>


<p>为了解决以上问题，在公共服务器上搭建了一个GitMirror，为每一个使用到的第三方库创建一个mirror仓库。以后每次执行install的时候，实际都是从本地服务器下载，速度就会有明显的提升。</p>

<h3>修改本地spec配置</h3>

<p>第一步要将第三库的源文件下载地址修改为本地服务器。写了一个脚本<code>moveToGitMirror.py</code>自动完成本地spec配置修改。执行命令如下：</p>

<pre><code>cd ~/.cocoapods/repos/master/
python moveToGitMirror.py
</code></pre>

<p>这个脚本的功能很简单，遍历当前目录下的文件，查找后缀名为.spec.json的文件，查找到source路径，然后修改为镜像地址。</p>

<p>这里需要注意的是，一旦修改，将完全依赖镜像的服务器。可以替换成一个指定的域名，而不是一个固定的ip地址。这样通过修改本地<code>hosts</code>文件，实现source路径的整体切换。</p>

<h3>为一个第三方库创建git mirror</h3>

<p>如果项目中需要一个第三方库，以<code>Masonry</code>为例。</p>

<pre><code>ssh root@xx.xx.xx.xx
cd GitRepoMirror/
git clone --mirror https://github.com/Masonry/Masonry.git
</code></pre>

<h3>设置免密码远程访问</h3>

<p>完成以上的操作，执行<code>pod install</code>，会发现下载一个第三方库都需要我们输入一次密码。what？？？太烦了！</p>

<p>为了实现免密码远程访问，我们需要把本机的rsa公钥放入远程服务器的<code>authorized_keys</code>文件下。如果本机没有生产过rsa密钥，执行以下命令：</p>

<pre><code>ssh-keygen -t rsa -C "xxx.com"
</code></pre>

<h2>下一步</h2>

<p>下一步，可以创建一个属于自己的私有pod repo了，以后再介绍。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-01-10T10:48:27+08:00" data-updated="true" itemprop="datePublished">Jan 10<span>th</span>, 2015</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/01/10/uiimagepickercontroller-cause-idletimerdisabled-setting-not-working/" itemprop="url">UIImagePickerController Cause idleTimerDisabled Setting Problem</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>前一段时间，遇到了一个奇怪的问题：在程序里设置了<code>idleTimerDisabled</code>为<code>YES</code>，但是还是有用户反馈，程序会自动锁屏。测试也曾反馈，曾经遇到过这个问题，但一直未找到重现方法。在Stackoverflow看到，与UIImagePickerController的使用有关。</p>

<h2>重现</h2>

<p>设置<code>idleTimerDisabled</code>为<code>YES</code>，创建UIImagePickerController，设置sourceType为<code>UIImagePickerControllerSourceTypeCamera</code>，然后弹出拍照页面。拍照页面关闭后，等待自动锁屏的出现。</p>

<h2>分析</h2>

<p>设置断点:</p>

<pre><code>-[UIApplication setIdleTimerDisabled:]
</code></pre>

<p><img src="/images/20150110_1.png" alt="idleTimer breakpoint" /></p>

<p>运行后会发现，在UIImagePickerController弹出的时候，进入一次断点。使用LLDB命令(因为我用的是arm64的机器，所以寄存器为x，如果是armv7，为r)：</p>

<pre><code>po $x0
&lt;UIApplication: 0x156e008e0&gt;

p (SEL)$x1
(SEL) $1 = "setIdleTimerDisabled:"

po $x2
1
</code></pre>

<p>在弹出UIImagePickerController的时候，系统会自动将<code>idleTimerDisabled</code>设置为<code>YES</code>。</p>

<p>继续运行，关闭UIImagePickerController，由于这只的animation为<code>YES</code>，会进入两次断点。两次的参数相同，都为<code>nil</code>。</p>

<pre><code>po $x2
nil
</code></pre>

<p>这就会将<code>idleTimerDisabled</code>设置为<code>NO</code>，导致之前设置的值被修改。</p>

<h2>解决</h2>

<p>目前想到的解决方法，在UIImagePickerController消失后，重新设置idleTimerDisabled为需要的值。</p>

<pre><code>#pragma mark - UIImagePickerControllerDelegate

- (void)imagePickerController:(UIImagePickerController *)picker         didFinishPickingMediaWithInfo:(NSDictionary *)info
{
    [self dismissViewControllerAnimated:YES completion:^{
    [self performSelector:@selector(resetIdleTimerDisabled) withObject:nil          afterDelay:1.0];
     }];
}

- (void)imagePickerControllerDidCancel:(UIImagePickerController *)picker
{
  [self dismissViewControllerAnimated:YES completion:^{
  [self performSelector:@selector(resetIdleTimerDisabled) withObject:nil        afterDelay:1.0];
   }];
}
</code></pre>

<p>参考：</p>

<p><a href="http://stackoverflow.com/questions/23391564/ios-idletimerdisabled-yes-works-only-until-imagepicker-was-used">http://stackoverflow.com/questions/23391564/ios-idletimerdisabled-yes-works-only-until-imagepicker-was-used</a></p>

<p><a href="http://www.objc.io/issue-19/">http://www.objc.io/issue-19/</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-19T11:11:55+08:00" data-updated="true" itemprop="datePublished">Oct 19<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/19/mac-booksheng-ji-yosemiteyi-chang-de-jie-jue-fang-fa/" itemprop="url">Mac book升级Yosemite异常的解决方法</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>前天苹果更新新版桌面操作系统OS X Yosemite，版本号为OS X 10.10。兴匆匆地升级我的Mac book，等了好久，更新重启之后出现了下面这个画面：</p>

<p><img src="/images/20141019.jpg" alt="OooppP" /></p>

<p>解决方法很简单：</p>

<ul>
<li>第一步：长按关机键，然后重新启动，同时一直按住<code>alt</code>键</li>
<li>第二步：在出现的界面选择无线网络，并成功连接</li>
<li>第三部：按<code>command</code> ＋ <code>r</code>，进入网络恢复模式</li>
</ul>


<p>经过N久的等待，终于又恢复正常了，开始体验新的OS X —— Yosemite！</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-19T10:35:11+08:00" data-updated="true" itemprop="datePublished">Oct 19<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/19/the-python-challenge-level-3/" itemprop="url">The Python Challenge–Level 3</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Level3地址：<a href="http://www.pythonchallenge.com/pc/def/equality.html">http://www.pythonchallenge.com/pc/def/equality.html</a></p>

<h2>分析</h2>

<p>提示文字：</p>

<pre><code>One small letter, surrounded by EXACTLY three big bodyguards on each of its sides.
</code></pre>

<p>根据上一次的经验，查看网页的源码，标题为<code>re</code>，看来和正则表达式有关系了。</p>

<p>网页源码里仍然有一段被注释的字符串，看来就要在这一串中找出两边大写中间小写字母的内容了。</p>

<h2>解决</h2>

<pre><code>text = ‘’’
       …
       ‘’’
import re
pattern = re.compile(r'[A-Z]{3}([a-z])[A-Z]{3}')
result = re.findall(pattern,text)
print(‘’.join(result))
</code></pre>

<p>发现打印出来很多结果，哪里出了问题？</p>

<p>再仔细看提示语：<code>EXACTLY</code>，必须是有且只有三个大写字母。</p>

<p>修改正则表达式：</p>

<pre><code>pattern = re.compile(r'[^A-Z][A-Z]{3}([a-z])[A-Z]{3}[^A-Z]')
</code></pre>

<p>输出：</p>

<pre><code>linkedlist
</code></pre>

<h2>其他解决方法</h2>

<p><a href="http://www.pythonchallenge.com/pcc/def/linkedlist.php">http://www.pythonchallenge.com/pcc/def/linkedlist.php</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-19T09:15:54+08:00" data-updated="true" itemprop="datePublished">Oct 19<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/19/the-python-challenge-level-2/" itemprop="url">The Python Challenge–Level 2</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>分析</h2>

<p>Level2的地址：<a href="http://www.pythonchallenge.com/pc/def/ocr.html">http://www.pythonchallenge.com/pc/def/ocr.html</a></p>

<p>文字提示<code>MAYBE they are in the page source</code></p>

<p>查看网页的源码，发现注释的部分：</p>

<pre><code>find rare characters in the mess below:
</code></pre>

<p>需要从那段内容中找出稀少的字符。</p>

<h2>解决</h2>

<pre><code>text = ‘’’
      …
       ‘’’
result = {}
for x in text:
    result[x] = result.get(x,0) + 1
print(result)
</code></pre>

<p>输出：</p>

<pre><code>{'(': 6154, ')': 6186, '*': 6034, '+': 6066, 'l': 1, 'i': 1, ' ': 4880, '!': 6079, '#': 6115, '$': 6046, '%': 6104, '&amp;': 6043, 'e': 1, 'y': 1, '{': 6046, '}': 6105, 'q': 1, 't': 1, 'u': 1, 'a': 1, '\n': 1221, '@': 6157, '[': 6108, ']': 6152, '^': 6030, '_': 6112}
</code></pre>

<p>发现最少的都是个数为1的字母，这样稍加改变：</p>

<pre><code>result = []
for x in text:
    if x.isalpha():
        result.append(x)
print(''.join(result))
</code></pre>

<p>输出：</p>

<pre><code>equality
</code></pre>

<h2>其他的解决方法</h2>

<p>按照惯例，查看解决方法：<a href="http://www.pythonchallenge.com/pcc/def/ocr.html">http://www.pythonchallenge.com/pcc/def/ocr.html</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-11T21:46:08+08:00" data-updated="true" itemprop="datePublished">Oct 11<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/11/the-python-challenge-level-1/" itemprop="url">The Python Challenge&#8211;Level 1</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Level 1的地址：<a href="http://www.pythonchallenge.com/pc/def/map.html">http://www.pythonchallenge.com/pc/def/map.html</a></p>

<h2>分析</h2>

<p>网页的标题为<code>What about making trans?</code>，然后再看图片：</p>

<pre><code>K -&gt; M
O -&gt; Q
E -&gt; G
</code></pre>

<p>应该是一个类似凯撒密码的字母移位，每个字母向后移动两位，而要处理的就是下面那段文字。</p>

<h2>解决</h2>

<p>代码如下：</p>

<pre><code>'''
Level 1
'''
text = '''
g fmnc wms bgblr rpylqjyrc gr zw fylb. rfyrq ufyr amknsrcpq ypc dmp. bmgle gr   gl zw fylb gq glcddgagclr ylb rfyr'q ufw rfgq rcvr gq qm jmle. sqgle    qrpgle.kyicrpylq() gq pcamkkclbcb. lmu ynnjw ml rfc spj.
'''
trans = ''
for x in text:
    trans += chr((ord(x) - ord('a') + 2)%26 + ord('a')) if x.isalpha() else x
print(trans)
</code></pre>

<p>输出结果：</p>

<pre><code>i hope you didnt translate it by hand. thats what computers are for. doing it in
by hand is inefficient and that's why this text is so long. using string.maketrans() 
is recommended. now apply on the url.
</code></pre>

<p>根据转化后的信息，处理url中的map进行同样的转换，获得新的url：<a href="http://www.pythonchallenge.com/pc/def/ocr.html">http://www.pythonchallenge.com/pc/def/ocr.html</a>，顺利进入下一关。</p>

<h2>str.maketrans()</h2>

<p>等等，仔细看转换后的信息，推荐使用string.maketrans()方法。</p>

<p>查找<a href="https://docs.python.org/3/">python3在线文档</a>，发现在python3.4后有所变化。</p>

<p>代码如下：</p>

<pre><code>''
use str.maketrans()
'''

import string

text = '''
g fmnc wms bgblr rpylqjyrc gr zw fylb. rfyrq ufyr amknsrcpq ypc dmp. bmgle gr   gl zw fylb gq glcddgagclr ylb rfyr'q ufw rfgq rcvr gq qm jmle. sqgle    qrpgle.kyicrpylq() gq pcamkkclbcb. lmu ynnjw ml rfc spj.
'''

dlist = string.ascii_lowercase
table = str.maketrans(dlist,dlist[2:] + dlist[:2])
print(text.translate(table))
</code></pre>

<p>首先，使用str.maketrans()方法生成一个映射表，从[A－Z]映射为[C-A]，打印<code>table</code>：</p>

<pre><code>{97: 99, 98: 100, 99: 101, 100: 102, 101: 103, 102: 104, 103: 105, 104: 106, 105: 107, 106: 108, 107: 109, 108: 110, 109: 111, 110: 112, 111: 113, 112: 114, 113: 115, 114: 116, 115: 117, 116: 118, 117: 119, 118: 120, 119: 121, 120: 122, 121: 97, 122: 98}
</code></pre>

<p>然后，调用translate()方法，将映射表作为参数。最终获取想要的结果。</p>

<p><code>str.maketrans()</code>的第一个和第二个参数长度必须相同，转换的时候一一对应；如果有第三个参数，将会转换为<code>None</code>。</p>

<pre><code>mm = 'abcdefg'
tb1 = str.maketrans('abcd','1234')
tb2 = str.maketrans('abcd','1234','ef')
print(mm.translate(tb1))
print(mm.translate(tb2))
</code></pre>

<p>输出结果：</p>

<pre><code>1234efg
1234g
</code></pre>

<h2>其他的解决方法</h2>

<p>进入下一个Level的页面，有一条tips，将当前url中的<code>pc</code>改为<code>pcc</code>就可以查看前一个Level的解决方法了。</p>

<p><a href="http://www.pythonchallenge.com/pcc/def/ocr.html">http://www.pythonchallenge.com/pcc/def/ocr.html</a></p>

<p>参考资料：</p>

<p><a href="https://docs.python.org/3/">Python documentation</a></p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    王仙客


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






		</div>
	</div>
</body>
</html>
